<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <title>Text Area Examples</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <style>

      html {
        background-size: cover;
        box-sizing: border-box;
      }
      
      *,
      *:before,
      *:after {
        box-sizing: inherit;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      }

      textarea {
        border: 1px solid currentColor;
      }

      textarea:focus {
        border: 1px solid #fff;
        box-shadow: 0 0 0 2px #fff;
        outline: 4px dotted #6da003;
      }

      :disabled { 
        opacity: .5;
      }

      ::-webkit-textarea-placeholder { /* Chrome/Opera/Safari */
        color: #757575;
      }

      ::-moz-placeholder { /* Firefox 19+ */
        color: #757575;
      }

      :-ms-textarea-placeholder { /* IE 10+ */
        color: #757575;
      }

      .visually-hidden {
      clip: rect(1px, 1px, 1px, 1px);
      height: 1px;
      overflow: hidden;
      position: absolute;
      white-space: nowrap;
      width: 1px;
      }

    </style>
  </head>
  <body>
    <main>

      <h1> Text Area Examples</h1>
      <p role="text">Example showing barebones text area examples.</p>

      <form novalidate>

        <h2>Character Counter</h2>
        
        <p role="text">The following shows how to count and limit the characters.</p>
        
        <span class="visually-hidden">start of text area with limited characters and character counter example</span>
        
        <label for="character-limit">Description:</label>

        <textarea id="character-limit" aria-describedby="remaining"></textarea>

        <span id="special-announcements" class="visually-hidden" aria-live="assertive"></span>
        
        <p role="text" id="remaining">Characters remaining 300</p>

        <span class="visually-hidden">end of text area with limited characters  and character counter example</span>

        <h2>Disabled</h2>
        
        <p role="text">The following shows how to disable text area fields with the <code>disabled</code> attribute.</p>
        
        <p role="text">NOTE: <code>disabled</code> text area are not focusable.</p>
        
        <span class="visually-hidden">start of disabled text area example</span>
        
        <label for="disabled-textarea">Description:</label>

        <textarea id="disabled-textarea" disabled></textarea>
        
        <span class="visually-hidden">end of disabled text area example</span>

        <h2>Required</h2>
        
        <p role="text">The following shows how to make text area fields required with the <code>aria-required</code> attribute.</p>
        
        <span class="visually-hidden">start of aria required text area example</span>
        
        <label for="required-textarea"><span aria-hidden="true">*</span>Description:</label>

        <textarea id="required-textarea" aria-required="true"></textarea>
        
        <span class="visually-hidden">end of aria required text area example</span>

        <h2>Invalid</h2>
        
        <p role="text">The following shows how to designate invalid text area fields with the <code>aria-invalid</code> attribute.</p>
        
        <span class="visually-hidden">start of invalid text area example</span>
        
        <label for="invalid-textarea">Description:</label>

        <textarea id="invalid-textarea" aria-invalid="true"></textarea>
        
        <span class="visually-hidden">end of invalid text area example</span>

      </form>

    </main>
 
    <script>
    
      //For screen readers to announce remaining characters
      function SpecialAnnouncement() {
        this.liveRegion = document.querySelector('#special-announcements');
      };

      SpecialAnnouncement.prototype.on = function() {
        this.liveRegion.setAttribute('aria-live', 'assertive')
      }

      SpecialAnnouncement.prototype.off = function() {
        this.liveRegion.setAttribute('aria-live', 'off')
      }

      SpecialAnnouncement.prototype.clearAnnouncement = function() {
        setTimeout(function() {
          this.liveRegion.textContent = '';
        }, 1000 );    
      };

      SpecialAnnouncement.prototype.announce = function(remainingCharacters) {
        this.liveRegion.textContent = remainingCharacters + ' characters remaining';
      };

      SpecialAnnouncement.prototype.announceOnPause = function(remainingCharacters) {
        console.log('ehadlfj;')
        setTimeout(this.announce(remainingCharacters), 2000);
      };

      //Character Counter
      function CharacterMaxCountDownTextarea(event) {
        this.remaining = document.querySelector('#remaining');
        this.targ = event.target;
        this.characters = event.target.value;
        this.count = this.characters.length;
        this.max = 300;
        this.diff = this.max - this.count;
      };

      CharacterMaxCountDownTextarea.prototype.visualChange = function() {
        this.remaining.textContent = 'Characters remaining ' + this.diff;
      };

      CharacterMaxCountDownTextarea.prototype.resetStyleAndAttribute = function() {
        this.remaining.style.color = '';
        this.targ.setAttribute('aria-invalid', false);        
      };

      CharacterMaxCountDownTextarea.prototype.exceedsMax = function() {
        if (this.diff < 0) {
          this.remaining.style.color = 'red';
          this.targ.setAttribute('aria-invalid', true);
          console.log("You've exceeded maximum amount of "+this.max+" characters!");
        }; 
      };

      var forLiveRegion = new SpecialAnnouncement()

      CharacterMaxCountDownTextarea.prototype.initialize = function() {
        this.visualChange();
        this.resetStyleAndAttribute();
        this.exceedsMax();
        forLiveRegion.announceOnPause(this.diff);
      };

      //Event listeners for character count
      document.querySelector('#character-limit').addEventListener('click', function(event) {
        new CharacterMaxCountDownTextarea(event).initialize() 
      });

      document.querySelector('#character-limit').addEventListener('keydown', function(event) {
        new CharacterMaxCountDownTextarea(event).initialize()
      });

      Event listeners for special annoucement
      document.querySelector('#character-limit').addEventListener('keyup', function() {
        forLiveRegion.on()
        setTimeout(forLiveRegion.off(), 1000)
      });

    </script>
  </body>
</html>